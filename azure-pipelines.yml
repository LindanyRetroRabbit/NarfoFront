trigger:
- Dev

pool:
  vmImage: 'Ubuntu-16.04'

steps:
- task: AzureCLI@1
  inputs:
    azureSubscription: 'Azure for Students Starter(efd75f38-514f-4465-892f-a99f48dbd70d)'
    scriptLocation: 'scriptPath'
    scriptPath: 
    addSpnToEnvironment: true
    useGlobalConfig: true
    workingDirectory: 'master'
    versionSpec: '8.x'
  displayName: 'Install Node.js'

- script: 
    cd frontend
    npm install
    npm run build --output $(Build.ArtifactStagingDirectory)
  displayName: 'npm install and build'

- task: PublishBuildArtifacts@1

# Node.js with React
- task: AzureRmWebAppDeployment@4
  inputs:
    ConnectionType: 'AzureRM'
    appType: 'webApp'
    WebAppName: 'NarfoFrontend'
    packageForLinux: '$(System.DefaultWorkingDirectory)/**/*.zip'
# Build a Node.js project that uses React.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript


- task: AzureWebApp@1
  inputs:
    azureSubscription: 'Azure for Students Starter (efd75f38-514f-4465-892f-a99f48dbd70d)'
    appType: 'webAppLinux'
    appName: 'NarfoFrontend'
    package: '$(System.DefaultWorkingDirectory)/**/*.zip'
